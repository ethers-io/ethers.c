#include <stdio.h>

#include "cbor.h"
#include "transaction.h"

int main() {
    uint8_t data[] = {
        251, 50, 185, 91, 20, 107, 190, 229, 247, 42, 23, 186,
        58, 99, 24, 1, 174, 50, 108, 28, 74, 113, 69, 122, 110,
        129, 106, 90, 70, 80, 96, 96, 164, 97, 118, 1, 98, 111,
        112, 115, 102, 102, 120, 95, 115, 105, 103, 110, 84, 114,
        97, 110, 115, 97, 99, 116, 105, 111, 110, 98, 105, 100, 2,
        97, 112, 170, 103, 99, 104, 97, 105, 110, 73, 100, 67, 170,
        54, 167, 104, 103, 97, 115, 76, 105, 109, 105, 116, 66, 82,
        8, 100, 116, 121, 112, 101, 65, 2, 101, 110, 111, 110, 99,
        101, 64, 108, 109, 97, 120, 70, 101, 101, 80, 101, 114, 71,
        97, 115, 67, 15, 69, 208, 116, 109, 97, 120, 80, 114, 105,
        111, 114, 105, 116, 121, 70, 101, 101, 80, 101, 114, 71,
        97, 115, 67, 15, 66, 64, 101, 118, 97, 108, 117, 101, 65,
        1, 100, 102, 114, 111, 109, 84, 18, 52, 86, 120, 144, 18,
        52, 86, 120, 144, 18, 52, 86, 120, 144, 18, 52, 86, 120,
        144, 98, 116, 111, 84, 139, 161, 241, 9, 85, 27, 212, 50,
        128, 48, 18, 100, 90, 193, 54, 221, 214, 77, 186, 114, 100,
        100, 97, 116, 97, 64
    };

    CborCursor cursor;
    cbor_init(&cursor, &data[32], sizeof(data) - 32);
    cbor_followKey(&cursor, "p");

    cbor_dump(&cursor);

    uint8_t rlpData[256];
    size_t rlpLength = sizeof(rlpData);
    TxStatus txStatus = tx_serializeUnsigned(&cursor, rlpData, &rlpLength);

    printf("RLP: length=%zu\n0x", rlpLength);
    for (int i = 0; i < rlpLength; i++) {
        printf("%02x", rlpData[i]);
    }
    printf("\n");

    return 0;
}
